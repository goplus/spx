<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport"
		content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
	<title>XGo Builder</title>
	<style>
		*:focus {
			outline: none;
			background-color: black;
		}

		#canvas,
		#gameCanvas {
			display: block;
			margin: 0;
			color: white;
		}
		
		body {
			background-color: #333;
			margin: 0;
			color: white;
		}
		/* 添加动画容器和动画盒子的样式 */
		.control-group {
			margin-bottom: 20px;
		}
		
		.animation-container {
			width: 300px;
			height: 30px;
			background-color: #f0f0f0;
			position: relative;
			overflow: hidden;
			border-radius: 15px;
			margin-top: 10px;
		}
		
		.animation-box {
			width: 50px;
			height: 20px;
			background-color: #4CAF50;
			position: absolute;
			top: 5px;
			left: 0;
			border-radius: 10px;
			animation: slide 2s infinite alternate ease-in-out;
		}
		
		@keyframes slide {
			0% {
				left: 0;
			}
			100% {
				left: calc(100% - 50px);
			}
		}
	</style>
</head>

<body>
	<button id="startGameBtn">Start</button>
	<button id="stopGameBtn">Stop</button>
	<button id="startNewGameBtn">StartNew</button>
	<progress id="progress-bar" value="0" max="1" style="display: none;"></progress>
	<div id="tabs">
		<div id="tab-loader">
		</div>
		<div id="tab-game" style="display: none;">
		</div>
	</div>
	<div class="control-group">
		<h2>Test Animation</h2>
		<div class="animation-container">
			<div class="animation-box"></div>
		</div>
	</div>
	<iframe id="runnerFrame" src="runner.html" width="1600" height="700"></iframe>

	<script>
		window.addEventListener('load', function() {
			animateBox();
		});

		function animateBox() {
			const box = document.querySelector('.animation-box');
			if (!box) return;
			const style = window.getComputedStyle(box);
			if (style.animationName !== 'none') return;
			let position = 0;
			let direction = 1;
			setInterval(() => {
				if (position >= 250) direction = -1;
				if (position <= 0) direction = 1;
				
				position += direction * 2;
				box.style.left = position + 'px';
			}, 20);
		}

		let runnerWindow = {}
		document.getElementById('startNewGameBtn').addEventListener('click', startNewGame);
		document.getElementById('startGameBtn').addEventListener('click', startGame);
		document.getElementById('stopGameBtn').addEventListener('click', stopGame);
		runnerWindow = document.getElementById('runnerFrame').contentWindow;
		function onProgress(value) {
			document.getElementById('progress-bar').value = value;
			if (value >= 1) {
				document.getElementById('tab-game').style.display = 'block';
				document.getElementById('tab-loader').style.display = 'none';
			}
			document.getElementById('progress-bar').style.display = value >= 1 ? 'none' : 'block';
		}

		async function startNewGame() {
			await startProject('/diff.zip')
		}

		async function startGame() {
			await startProject('/game.zip')
		}

		async function stopGame() {
			runnerWindow.stopGame()
		}

		async function startProject(zipUrl) {
			runnerWindow.addEventListener('onProgress', (event) => {
				onProgress(event.detail.progress)
			})
			runnerWindow.onGameError(function (callback) {
				console.error("onGameError", callback)
			})
			runnerWindow.spxIsForceDebugLog = true
			let buffer = await (await (fetch(zipUrl))).arrayBuffer();
			await runnerWindow.startGame(buffer, null, function () {
				runnerWindow.setAIInteractionAPIEndpoint("http://127.0.0.1:8000")
			});
		}
	</script>
</body>

</html>
